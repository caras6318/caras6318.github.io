---
title: CS ALU, 제어장치와 레지스터
date: 2024-04-15 20:04 +0900
categories: CS
tags:
  - CS
  - CPU
---
## Intro
---
저번에 공부한 CPU의 산술논리연산장치(ALU),와 제어장치에 관해서 더욱 자세히 알아보려고 한다.
>아래 내용은 공부한 내용을 정리한 것으로 틀린 내용이 포함되어 있을 수 있습니다.  

## ALU
---
CPU 내부에서 계산을 담당하는 장치로 다음과 같이 정보를 받아들이고 내보낸다.

![[ALU.png]]

레지스터로부터 연산에 필요한 *피연산자* 를 받아들이고, 제어장치로부터  어떠한 연상을 할지 *제어신호* 를 받아들인다. 이 두가지의 정보를 가지고 산술연산, 논리 연산등 다양한 연산을 수행한다. 이렇게 연산된 결과는 메모리가 아닌 레지스터에 저장된다. (메모리에 접근하는데 소요되는 시간이 레지스터에 비해 훨씬 느리기 때문) 
또한 연산결과만이 아니라 *플래그* 도 내보내게 되는데 이 플래그는 연산결과에 대한 추가적인 상태정보를 의미한다. 대표적인 예시로는 다음과 같은것들이 있다.

![[ALU_Flags.png]]

CPU가 프로그램을 실행하는데에는 이러한 플래그 값들이 필수적이기 때문에 다음과 같이 플래그 레지스터에 저장된다. ex) 연산결과가 0일경우

![[ALU_Flag_ex.png]]

## 제어장치
---
제어장치는 제어 신호를 내보내고 명령어를 해석하는 부품으로 다음과 같이 움직인다.

![[CPU.png]]

1. 클럭 신호를 받아들인다. (제어장치에서 사용되는 시간단위)
   ![[]]
   2. 명령어 레지스터에서 해석해야하는 명령어를 가져온다.
   3. 플래그 레지스터에서 플래그값을 가져온다.
   4. 제어버스로 전달된 제어신호를 받는다.
   5. 명령어에 맞는 제어신호를 발생시켜 제어버스로 전달해 CPU 외부로 전달한다.
## 레지스터
---
프로그램 속의 명령어와 데이터는 실행 전후로 반드시 레지스터에 저장된다. 다양한 레지스터들이 존재하며 각기 다른 역할을 가진다. 많은 레지스터들이 존재하지만 대표적으로는 다음과 같은 8개가 있다.

### 1. 프로그램 카운터(Program Counter)
---
메모리에서 가져올 명령어의 주소를 저장한다. PC가 아니라 명령어 포인터(Instruction Pointer)IP 라고 하기도한다. 베이스 레지스터와 같이 변위 주소 지정 방식에 사용되는 레지스터
### 2. 명령어 레지스터(Instruction Register)
---
메모리에서 읽어들인 명령어를 저장하는 레지스터이다. 제어장치에서 명령어 레지스터에 있는 명령어를 받아 해석한 후 제어 신호를 내보낸다.
### 3. 메모리 주소 레지스터(Memory Address Register)
---
메모리의 주소를 저장하는 레지스터이다.CPU가 읽어들어고자 하는 주소 값을 주소버스로 보낼때 거치게된다.
### 4. 메모지 버퍼 레지스터(Memory Buffer Register)
---
메모리와 주고받을 값(데이터와 명령어)를 저장하는 레지스터로 메모리에 쓰고 싶은 값이나 메모리로부터 전달받은 값은 메모리 버퍼 레지스터를 거친다. 데이터버스로 주고받을값이 거치게 된다. 또한 메모리 데이터 레지스  (Memory Buffer Register) MDR 이라고도 한다.
### 5. 플래그 레지스터(Flag Register)
---
ALU의 연산결과에 따른 플래그를 저장하는 레지스터
### 6. 범용 레지스터(General Purpose Register)
---
이름 그대로 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터이다.
메모리 버퍼 레지스터는 데이터버스, 메모리 주소 레지스터는 주소버스에 이용하는 레지스터이지만, 범용 레지스터는 데이터와 주소 모두 저장할 수 있다.
### 7. 스택 포인터(Stack Pointer)
---
스택주소 지정 방식에 사용될 수 있는 레지스터이다. 스택의 꼭대기를 가리키는 레지스터 
즉, 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터이다.
여기서 말하는 스택이란 메모리들에는 스택처럼 사용할 영역이 정해져 있어 이 영역을 스택영역 이라고 한다.
### 8. 베이스 레지스터
---
프로그램 카운터와 같이 변위 주소 지정 방식에 사용되는 레지스터
#### 변위 주소 지정 방식
---
명령어는 연산코드와 오퍼랜드로 이루어져있다. 오퍼랜드 필드에는 메모리주소가 담길때도 있는데 오퍼랜드 필드값에 특정 레지스터의 값을 더해서 유효주소를 얻어내는 주소지정 방식이다.

![[변위주소지정방식.png]]

이러한 변위 주소 지정 방식을 사용하는 명령어는 기존의 연산코드 필드와 오퍼랜드 필드에 추가로 어떤 레지스터의 값과 더할지를 나타내는 레지스터 필드가 있다.

![[변위주소지정방식명령어.png]]

위와 같은 명령어를 사용하는 변위 주소 지정 방식은 어떤 레지스터를 더하는지에 따라서 *상대주소 지정방식*과 베이스 *레지스터주소 지정방식* 등으로 나뉜다.
 
#### 상대 주소 지정 방식
---
상대 주소 지정 방식은 오퍼랜드와 프로그램 카운터의 값을 더해서 유효주소를 얻는 방식으로 프로그램 카운터에는 읽어들일 명령어의 주소가 저장되어 있어 오퍼랜드의 숫자에 따라서 실행할 명령어가 들어있는 위치에서 움직여 해당 주소의 명령어를 실행하게 된다. 보통 if문처럼 분기해서 특정 주소의 코드를 실행할 때 사용된다.

![[상대 주소 지정 방식.png]]

#### 베이스 레지스터 주소 지정 방식
---
베이스 레지스터 주소 지정 방식은 오퍼랜드와 베이스 레지스터의 값을 더해서 유효주소를 얻는 방식이다.
베이스 레지스터는 *기준 주소*, 오퍼랜드는 *기준 주소로부터 떨어진 거리* 를 나타낸다.

![[베이스 레지스터 주소 지정 방식.png]]

## 명령어 사이클과 인터럽트
---
CPU 가 하나의 명령어를 처리하는데는 일정한 흐름이 존재하고 이 흐름을 반복해서 명령어들을 처리해 나간다.
이러한 흐름을 *명령어 사이클* 이라고 한다. 하지만 이러한 흐름대로 진행되다 끊어지는 상황이 발생하는데 
이를 *인터럽트* 라고한다.

### 명령어 사이클
---
명령어 사이클에는 일정한 흐름이 있는데 
1. 메모리에서 명령어를 CPU로 가지고 오는 *인출 사이클*
2. 해당 명령어를 실행하는 *실행 사이클*
3. 위의 2사이클을 반복하다 간접 주소 지정 방식과 같이 다른 메모리에 한번더 접근이 필요하면 *간접 사이클*
   을 통해서 처리한다.
4. 추가적으로 *인터럽트*가 발생하면 처리한다.
### 인터럽트
---
CPU가 수행 중인 작업은 방해를 받아서 잠시 중단될 수 있는데 이러한 방해하는 신호를 인터럽트라고 한다.
*CPU가 우선적으로 처리해야 하는 다른 작업* 을 의미한다고도 할 수 있다.

인터럽트에는 *동기 인터럽트* 와 *비동기 인터럽트*가 존재한다.

#### 동기 인터럽트
---
동기 인터럽트는 CPU에 의해서 발생하는 인터럽트로 CPU가 명령어를 처리하다 예상치 못한 상황이 생기면 발생한다. 프로그래밍상의 오류와 같은 *예외* 를 의미한다.

#### 비동기 인터럽트
---
주로 입출력 장치에 의해서 발생하는 인터럽트로 입력장치에 의한 작업이 완료되면 이를 알리기 위해서 인터럽트를 보낸다. *하드웨어 인터럽트* 라고도 한다. 다음과 같은 프로세스로 이루어진다.

1. 입출력 장치가 CPU에 *인터럽트 요청신호* 를 보낸다. (인터럽트를 요청해도 되는지)
2. 실행 사이클이 끝나고 명령어를 인출하기 전 인터럽트 여부를 확인한다.
3. 인터럽트 요청을 확인하고 *인터럽트 플래그* 를 통해서 인터럽트를 이용할 수 있는지 판단한다.
   (작업의 중요도에 따라 요청을 무시할지 받을지 정하는 플래그를 무시 가능한 인터럽트도 있다.) 
4. 가능할 시 지금까지의 작업을 백업한다.
5. *인터럽트 벡터* 를 참조해서(인터럽트 서비스 루틴을 식별하기 위한 정보와 시작주소) 
   *인터럽트 서비스 루틴* 을 실행한다. (인터럽트를 처리하기 위한 프로그램)
6. 인터럽트 서비스 루틴이 끝나면 백업해둔 작업을 복구해 실행한다.

이러한 명령어 사이클을 정리하면 다음과 같다.

![[명령어 사이클.png]]
### Reference
---
[혼자 공부하는 컴퓨터구조 + 운영체제](https://product.kyobobook.co.kr/detail/S000061584886?utm_source=google&utm_medium=cpc&utm_campaign=googleSearch&gt_network=g&gt_keyword=&gt_target_id=aud-901091942354:dsa-1974044871038&gt_campaign_id=9979905549&gt_adgroup_id=132556570510&gad_source=1&gclid=CjwKCAjw8diwBhAbEiwA7i_sJbemSZyZm0pluIpaRXmbDOv8OEM3pQz0DIO1xd-cECAIwupwQLnvOBoCb1wQAvD_BwE)
